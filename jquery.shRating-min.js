/*!
 * jQuery shRating v1.0
 * http://jquery.sunhater.com/shRating
 * 2014-01-19
 *
 * Copyright (c) 2010-2014 Pavel Tzonkov <sunhater@sunhater.com>
 * Dual licensed under the MIT and GPL licenses.
 */
(function(a){a.fn.shRating=function(e){var d="jquery.shRating-min.js",f={best:5,value:0,count:0,disabled:false,ajaxUrl:"",callBack:false,starWidth:30,starHeight:30,empty:false,cssClass:"shRating",starsImage:"./stars30.png",stats:["None","Poor","Fair","Good","Very Good","Excellent"],labels:{error:"Unknown error!"},alertFunc:function(g){alert(g)}},c=a('script[src$="/'+d+'"]'),b={best:"bestRating",value:"ratingValue",count:"ratingCount"};if(typeof e=="undefined"){e={}}a.extend(f,e);if((f.starsImage.substr(0,2)=="./")&&c.get(0)){src=c.first().attr("src");f.starsImage=src.substr(0,src.length-d.length)+f.starsImage.substr(2,f.starsImage.length-2)}a(this).each(function(){var q=this,g=a.extend({},f),k=a("head"),o=a("body"),l="";a.each(b,function(v,s){if((typeof e[v]=="undefined")){var s=a(q).find('[itemprop="'+s+'"]'),t=a(q).attr(v),w=a(q).find("."+v);if(s.get(0)){var t=s.attr("content"),h=t?t:s.text();g[v]=h?parseFloat(h):0}else{if(t){g[v]=parseFloat(t)}else{if(w.get(0)){g[v]=parseFloat(w.text())}}}}});if(typeof g.stats[Math.ceil(g.value)]!="undefined"){var p=g.stats[Math.ceil(g.value)],j="ratingWord";a(q).find('[itemprop="'+j+'"]').html(p);a(q).find("."+j).html(p)}var r='<div class="'+g.cssClass+'"><div class="ratingEmpty"><div class="ratingBar"></div></div></div>',n=a(q).find("div > div.ratingEmpty");if(n.get(0)){n.parent().detach()}if(g.empty){a(q).html(r)}else{a(q).prepend(r)}var m="."+g.cssClass;if(!a("#css_"+g.cssClass).get(0)){var u=m+"{display:block;}"+m+" *{display:block;outline:0;border:0;margin:0;padding:0;}"+m+" .ratingEmpty{background:top left repeat-x;}"+m+" .ratingBar{position:absolute;float:left;background:bottom left repeat-x;}"+m+" .ratingChoice a,"+m+" .ratingChoice a:hover{position:absolute;background:center left;text-decoration:none;float:left;}";u='<style type="text/css" id="css_'+g.cssClass+'">'+u+"</style>";if(k.get(0)){k.append(u)}else{if(o.get(0)){o.append(u)}}}a(q).find(m).css({width:(g.starWidth*g.best)+"px",height:g.starHeight+"px"});a(q).find(m+" *").css({height:g.starHeight+"px"});a(q).find(m+" .ratingEmpty").css({backgroundImage:'url("'+g.starsImage+'")',width:(g.starWidth*g.best)+"px"});a(q).find(m+" .ratingBar").css({backgroundImage:'url("'+g.starsImage+'")',width:parseInt(g.value*g.starWidth)+"px"});if(!g.disabled){a(q).find(m+" .ratingEmpty").append('<div class="ratingChoice"></div>');for(var j=0;j<g.best;j++){a(q).find(m+" .ratingChoice").append('<a href="#">&nbsp;</a>')}a(q).find(m+" .ratingChoice a").each(function(t,h){var s=g.best-t;a(h).css({width:(s*g.starWidth)+"px",height:g.starHeight+"px"}).data("value",s);if(g.stats[s]){a(h).attr("title",g.stats[s])}}).mouseenter(function(){a(this).css("background-image",'url("'+g.starsImage+'")')}).mouseleave(function(){a(this).css("background-image","none")}).unbind("click").click(function(){var h=this;if(!g.ajaxUrl.length){g.alertFunc(g.labels.error)}else{a.ajax({url:g.ajaxUrl.replace("{value}",a(h).data("value")),dataType:"json",success:function(x){if(!x){g.alertFunc(g.labels.error);return false}if((!x.rating&&!x.value)||(!x.votes&&!x.count)){g.alertFunc(x.error?x.error:g.labels.error)}else{var t=parseFloat(x.value?x.value:x.rating),y=parseInt(x.count?x.count:x.votes),s=g.stats[Math.ceil(t)],i=function(A,v){var w=a(q).find('[itemprop="'+(b[A]?b[A]:A)+'"]'),z=a(q).find("."+A);if(w.get(0)){if(w.is("[content]")){w.attr("content",v)}else{w.html(v)}}else{if(a(q).is("["+A+"]")){a(q).attr(A,v)}else{if(z.get(0)){z.html(v)}}}};i("value",t);i("count",y);i("ratingWord",s);a(q).find("."+g.cssClass+" .ratingBar").css({width:(t*g.starWidth)+"px"});a(q).find("."+g.cssClass+" .ratingChoice").detach();if(g.callBack){g.callBack(x)}}},error:function(){g.alertFunc(g.labels.error)}})}return false})}})}})(jQuery);