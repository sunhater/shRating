/*!
 * jQuery shRating v1.0-pre1
 * http://jquery.sunhater.com/shRating
 * 2014-01-16
 *
 * Copyright (c) 2010-2014 Pavel Tzonkov <sunhater@sunhater.com>
 * Dual licensed under the MIT and GPL licenses.
 */
(function(a){a.fn.shRating=function(e){var d="jquery.shRating-min.js",f={best:5,value:0,count:0,disabled:false,ajaxUrl:"",callBack:false,starWidth:30,starHeight:30,empty:false,cssClass:"shRating",starsImage:"./stars30.png",stats:["None","Poor","Fair","Good","Very Good","Excellent"],labels:{error:"Unknown error!"},alertFunc:function(g){alert(g)}},c=a('script[src$="/'+d+'"]'),b={best:"bestRating",value:"ratingValue",count:"ratingCount"};if(typeof e=="undefined"){e={}}a.extend(f,e);if((f.starsImage.substr(0,2)=="./")&&c.get(0)){src=c.first().attr("src");f.starsImage=src.substr(0,src.length-d.length)+f.starsImage.substr(2,f.starsImage.length-2)}a(this).each(function(){var o=this,g=a.extend({},f),k=a("head"),n=a("body"),l="";a.each(b,function(t,r){if(typeof e[t]=="undefined"){var r=a(o).find('[itemprop="'+r+'"]'),s=a(o).attr(t);m=a(o).find("."+t);if(r.get(0)){var s=r.attr("content"),h=s?s:r.text();g[t]=h?parseFloat(h):0}else{if(s){g[t]=parseFloat(s)}else{if(m.get(0)){g[t]=parseFloat(m.text())}}}}});var p='<div class="'+g.cssClass+'"><div class="ratingEmpty"><div class="ratingBar"></div></div></div>';if(g.empty){a(this).html(p)}else{a(this).prepend(p)}var m="."+g.cssClass;if(!a("#css_"+g.cssClass).get(0)){var q=m+"{display:block;}"+m+" *{display:block;outline:0;border:0;margin:0;padding:0;}"+m+" .ratingEmpty{background:top left repeat-x;}"+m+" .ratingBar{position:absolute;float:left;background:bottom left repeat-x;}"+m+" .ratingChoice a,"+m+" .ratingChoice a:hover{position:absolute;background:center left;text-decoration:none;float:left;}";q='<style type="text/css" id="css_'+g.cssClass+'">'+q+"</style>";if(k.get(0)){k.append(q)}else{if(n.get(0)){n.append(q)}}}a(this).find(m).css({width:(g.starWidth*g.best)+"px",height:g.starHeight+"px"});a(this).find(m+" *").css({height:g.starHeight+"px"});a(this).find(m+" .ratingEmpty").css({backgroundImage:'url("'+g.starsImage+'")',width:(g.starWidth*g.best)+"px"});a(this).find(m+" .ratingBar").css({backgroundImage:'url("'+g.starsImage+'")',width:parseInt(g.value*g.starWidth)+"px"});if(!g.disabled){a(this).find(m+" .ratingEmpty").append('<div class="ratingChoice"></div>');for(var j=0;j<g.best;j++){a(this).find(m+" .ratingChoice").append('<a href="#">&nbsp;</a>')}a(this).find(m+" .ratingChoice a").each(function(s,h){var r=g.best-s;a(h).css({width:(r*g.starWidth)+"px",height:g.starHeight+"px"}).data("value",r);if(g.stats[r]){a(h).attr("title",g.stats[r])}}).mouseenter(function(){a(this).css("background-image",'url("'+g.starsImage+'")')}).mouseleave(function(){a(this).css("background-image","none")}).unbind("click").click(function(){var h=this;if(!g.ajaxUrl.length){g.alertFunc(g.labels.error)}else{a.ajax({url:g.ajaxUrl.replace("{value}",a(h).data("value")),dataType:"json",success:function(s){if(!s){g.alertFunc(g.labels.error);return false}if((!s.rating&&!s.value)||(!s.votes&&!s.count)){g.alertFunc(s.error?s.error:g.labels.error)}else{var r=parseFloat(s.value?s.value:s.rating),t=parseInt(s.count?s.count:s.votes),i=g.stats[Math.ceil(r)];updateMarkup=function(x,u){var v=a(o).find('[itemprop="'+(b[x]?b[x]:x)+'"]');var w=a(o).find("."+x);if(v.get(0)){if(v.is("[content]")){v.attr("content",u)}else{v.html(u)}}else{if(a(o).is("["+x+"]")){a(o).attr(x,u)}else{if(w.get(0)){w.html(u)}}}};updateMarkup("value",r);updateMarkup("count",t);updateMarkup("ratingWord",i);a(o).find("."+g.cssClass+" .ratingBar").css({width:(r*g.starWidth)+"px"});a(o).find("."+g.cssClass+" .ratingChoice").detach()}},error:function(){g.alertFunc(g.labels.error)}})}return false})}})}})(jQuery);